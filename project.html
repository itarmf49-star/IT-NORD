<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT NORD | ูุดุฑูุน</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/project.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body class="project-page">
    <header class="header">
        <nav class="nav">
            <div class="nav-left">
                <a href="/" id="nav-home-link" class="nav-link" data-i18n="backToHome">โ ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</a>
            </div>
            <div class="nav-right">
                <a href="tel:+22247774141" class="nav-contact-btn" data-i18n="contact">๐ ุงุชุตู</a>
                <button class="lang-switcher" id="lang-switcher" title="ุชุบููุฑ ุงููุบุฉ">
                    <span class="lang-label" id="lang-label">EN</span>
                </button>
                <span class="brand-name">IT NORD</span>
                <div class="logo-small">
                    <div class="logo-circuit"><span>IT</span></div>
                </div>
            </div>
        </nav>
    </header>

    <main class="project-main" id="project-main">
        <div class="project-loading" id="project-loading">ุฌุงุฑู ุงูุชุญููู...</div>
        <article class="project-article hidden" id="project-article">
            <div class="project-hero">
                <div class="project-video-wrap" id="project-video-wrap">
                    <div class="project-video-container" id="project-video-container">
                        <iframe id="project-video" allowfullscreen allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" title="Video"></iframe>
                    </div>
                    <a id="project-video-link" href="#" target="_blank" rel="noopener" class="project-video-overlay hidden" title="ุชุดุบูู ุงูููุฏูู">
                        <img id="project-video-thumb" alt="" src="">
                        <span class="project-video-play">โถ</span>
                        <span class="project-video-label" data-i18n="playVideo">ุชุดุบูู ุงูููุฏูู</span>
                    </a>
                </div>
            </div>
            <div class="project-gallery" id="project-gallery"></div>
            <div class="project-content">
                <h1 id="project-title">ุนููุงู ุงููุดุฑูุน</h1>
                <div class="project-description" id="project-description"></div>
            </div>
        </article>
        <div class="project-notfound hidden" id="project-notfound">
            <p id="notfound-msg">ุงููุดุฑูุน ุบูุฑ ููุฌูุฏ</p>
            <p class="notfound-hint">ุชุฃูุฏ ูู ุชุดุบูู ุงูุฎุงุฏู (<code>python app.py</code>) ูุชุดุบูู <code>python seed_projects.py</code> ูุฅุถุงูุฉ ุงููุดุงุฑูุน.</p>
            <a href="/" id="notfound-back" class="btn-back" data-i18n="backToHome">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</a>
        </div>
    </main>

    <footer class="footer">
        <p>IT NORD โ For Technical Solutions</p>
    </footer>

    <script src="js/main.js"></script>
    <script>
        (function() {
            const path = window.location.pathname;
            const match = path.match(/\/project\/(\d+)/);
            const pid = match ? parseInt(match[1], 10) : parseInt(new URLSearchParams(location.search).get('id') || '0', 10);
            const API = (location.protocol === 'http:' || location.protocol === 'https:') ? location.origin + '/api' : '';

            const homeHref = (location.protocol === 'http:' || location.protocol === 'https:') ? '/' : 'index.html';
            document.getElementById('nav-home-link').href = homeHref;
            document.getElementById('notfound-back').href = homeHref;

            const loading = document.getElementById('project-loading');
            const article = document.getElementById('project-article');
            const notfound = document.getElementById('project-notfound');
            const notfoundMsg = document.getElementById('notfound-msg');
            const titleEl = document.getElementById('project-title');
            const descEl = document.getElementById('project-description');
            const videoWrap = document.getElementById('project-video-wrap');
            const videoEl = document.getElementById('project-video');
            const videoLink = document.getElementById('project-video-link');
            const videoThumb = document.getElementById('project-video-thumb');
            const galleryEl = document.getElementById('project-gallery');

            function applyLang() {
                const lang = localStorage.getItem('itnord_lang') || 'ar';
                document.documentElement.lang = lang === 'ar' ? 'ar' : 'en';
                document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
                document.getElementById('lang-label').textContent = lang === 'ar' ? 'EN' : 'ุงูุนุฑุจูุฉ';
                const t = typeof TRANSLATIONS !== 'undefined' ? (TRANSLATIONS[lang] || TRANSLATIONS.ar) : {};
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const k = el.getAttribute('data-i18n');
                    if (t[k]) el.textContent = t[k];
                });
            }

            document.getElementById('lang-switcher').onclick = () => {
                const lang = localStorage.getItem('itnord_lang') || 'ar';
                localStorage.setItem('itnord_lang', lang === 'ar' ? 'en' : 'ar');
                location.reload();
            };

            applyLang();

            async function load() {
                if (!pid) {
                    showNotFound('ุงููุดุฑูุน ุบูุฑ ููุฌูุฏ');
                    return;
                }
                if (!API) {
                    showNotFound('ูู ุจุชุดุบูู ุฎุงุฏู Python ุซู ุงูุชุญ ุงููููุน ูู: http://127.0.0.1:5000');
                    return;
                }
                try {
                    const res = await fetch(API + '/projects/' + pid);
                    if (!res.ok) {
                        showNotFound('ุงููุดุฑูุน ุบูุฑ ููุฌูุฏ');
                        return;
                    }
                    const p = await res.json();
                    const lang = localStorage.getItem('itnord_lang') || 'ar';
                    titleEl.textContent = lang === 'ar' ? (p.title_ar || p.title_en) : (p.title_en || p.title_ar);
                    descEl.textContent = lang === 'ar' ? (p.description_ar || p.description_en) : (p.description_en || p.description_ar);
                    document.title = 'IT NORD | ' + (p.title_ar || p.title_en || 'ูุดุฑูุน');

                    let videoUrl = (p.video_url || '').trim();
                    let vidId = '';
                    if (videoUrl) {
                        if (videoUrl.includes('youtube.com/watch')) {
                            try { vidId = new URL(videoUrl).searchParams.get('v') || ''; } catch (_) {}
                        } else if (videoUrl.includes('youtu.be/')) {
                            vidId = (videoUrl.split('youtu.be/')[1] || '').split('?')[0];
                        } else {
                            const m = videoUrl.match(/(?:embed\/|v=)([^?&#]+)/);
                            vidId = m ? m[1] : '';
                        }
                    }
                    if (vidId) {
                        videoEl.src = 'https://www.youtube-nocookie.com/embed/' + vidId;
                        videoLink.href = 'https://www.youtube.com/watch?v=' + vidId;
                        videoThumb.src = p.thumbnail_url || ('https://img.youtube.com/vi/' + vidId + '/maxresdefault.jpg');
                        videoThumb.onerror = function() { this.src = 'https://img.youtube.com/vi/' + vidId + '/hqdefault.jpg'; };
                        document.getElementById('project-video-container').classList.add('hidden');
                        videoLink.classList.remove('hidden');
                    } else if (p.thumbnail_url) {
                        document.getElementById('project-video-container').classList.add('hidden');
                        videoLink.href = '#';
                        videoLink.onclick = function(e) { e.preventDefault(); };
                        videoThumb.src = p.thumbnail_url;
                        videoLink.querySelector('.project-video-label').textContent = '';
                        videoLink.querySelector('.project-video-play').style.display = 'none';
                        videoLink.classList.remove('hidden');
                    }

                    let imgs = [];
                    try {
                        imgs = p.gallery_images ? JSON.parse(p.gallery_images) : [];
                    } catch (_) {}
                    if (imgs.length > 0) {
                        galleryEl.innerHTML = '<h3 class="gallery-title">' + (lang === 'ar' ? 'ุตูุฑ ูููุฏูููุงุช' : 'Photos & Videos') + '</h3><div class="gallery-grid">' +
                            imgs.map(u => '<img src="' + u + '" alt="" loading="lazy">').join('') + '</div>';
                        galleryEl.classList.remove('hidden');
                    } else {
                        galleryEl.classList.add('hidden');
                    }

                    loading.classList.add('hidden');
                    notfound.classList.add('hidden');
                    article.classList.remove('hidden');
                } catch (e) {
                    showNotFound('ุชุนุฐุฑ ุชุญููู ุงููุดุฑูุน. ุชุญูู ูู ุชุดุบูู ุงูุฎุงุฏู.');
                }
            }

            function showNotFound(msg) {
                if (notfoundMsg) notfoundMsg.textContent = msg || 'ุงููุดุฑูุน ุบูุฑ ููุฌูุฏ';
                loading.classList.add('hidden');
                article.classList.add('hidden');
                notfound.classList.remove('hidden');
            }

            load();
        })();
    </script>
</body>
</html>
